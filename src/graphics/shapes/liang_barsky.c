/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   liang_barsky.c                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: ksorokol <ksorokol@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/02/27 23:13:55 by ksorokol          #+#    #+#             */
/*   Updated: 2025/02/28 00:31:07 by ksorokol         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ksx_graphics.h"
#include <stdio.h>
#define LEFT 0
#define RIGHT 1
#define BOTTOM 2
#define TOP 3

/*
1. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Z-Ð¾Ñ‚ÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð›ÑÐ½â€“Ð‘Ð°Ñ€ÑÐºÐ¸:
ÐœÐ¾Ð¶Ð½Ð¾ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼, Ð´Ð¾Ð±Ð°Ð²Ð¸Ð² Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð´Ð»Ñ Ð³Ñ€Ð°Ð½Ð¸Ñ†:

near â€” Ð¿ÐµÑ€ÐµÐ´Ð½ÑÑ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑŒ Ð¾Ñ‚ÑÐµÑ‡ÐµÐ½Ð¸Ñ.
far â€” Ð·Ð°Ð´Ð½ÑÑ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑŒ Ð¾Ñ‚ÑÐµÑ‡ÐµÐ½Ð¸Ñ.
Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² ÐºÐ¾Ð´:

c
Copy
Edit
// Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð¿Ð¾ Z
p[4] = -dz; q[4] = z1 - z_near;  // Ð¿ÐµÑ€ÐµÐ´Ð½ÑÑ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑŒ (near)
p[5] = dz;  q[5] = z_far - z1;   // Ð·Ð°Ð´Ð½ÑÑ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑŒ (far)
2. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ ÐšÐ»Ð°Ð¹Ð¿Ð°â€“Ð‘Ð°Ñ€ÑÐºÐ¸ (Cyrusâ€“Beck):
Ð­Ñ‚Ð¾Ñ‚ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð¾Ð±Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ Ð›ÑÐ½â€“Ð‘Ð°Ñ€ÑÐºÐ¸ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð² Ñ‚Ñ€Ñ‘Ñ… Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸ÑÑ…, ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ñ Ð¾Ñ‚ÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ð²ÑÐµÐ¼ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑÐ¼ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ 
ð‘§
z). ÐžÐ´Ð½Ð°ÐºÐ¾ Ð¾Ð½ ÑÐ»Ð¾Ð¶Ð½ÐµÐµ Ð² Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸.

3. ÐžÑ‚ÑÐµÑ‡ÐµÐ½Ð¸Ðµ Ð² Ð¾Ð´Ð½Ð¾Ñ€Ð¾Ð´Ð½Ñ‹Ñ… ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ñ… (Clipping in Homogeneous Coordinates):
Ð­Ñ‚Ð¾ Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð² 3D-Ð³Ñ€Ð°Ñ„Ð¸ÐºÐµ:

Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾ÑÐ»Ðµ ÑƒÐ¼Ð½Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð½Ð° Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ†Ð¸Ð¸.
ÐžÑ‚Ñ€ÐµÐ·ÐºÐ¸ Ð¾Ñ‚ÑÐµÐºÐ°ÑŽÑ‚ÑÑ Ð² 4D-Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð¿ÐµÑ€ÑÐ¿ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ»ÐµÐ½Ð¸Ñ.
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ÑÑ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð´Ð»Ñ Ð²Ð¸Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸:
âˆ’
ð‘¤
â‰¤
ð‘¥
â‰¤
ð‘¤
âˆ’wâ‰¤xâ‰¤w
âˆ’
ð‘¤
â‰¤
ð‘¦
â‰¤
ð‘¤
âˆ’wâ‰¤yâ‰¤w
0
â‰¤
ð‘§
â‰¤
ð‘¤
0â‰¤zâ‰¤w â€” ÑÑ‚Ð¾ ÑƒÑÐ»Ð¾Ð²Ð¸Ðµ Ð¸ Ð¾Ñ‚ÑÐµÑ‡Ñ‘Ñ‚ Ð²ÑÐµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ð·Ð° ÐºÐ°Ð¼ÐµÑ€Ð¾Ð¹.
*/

uint32_t	liang_barsky(t_pixel *p_pix1, t_pixel *p_pix2,
		t_pixel *p_pix1n, t_pixel *p_pix2n)
 {
    float	pq[2][4];
	float	t_in = 0.0f, t_out = 1.0f;
    float dx = p_pix2->x - p_pix1->x;
    float dy = p_pix2->y - p_pix1->y;
    
    // pq[0][LEFT] = -dx;
	// pq[1][LEFT] = p_pix1->x + WIDTH * .5f;
    // pq[0][RIGHT] = dx;
	// pq[1][RIGHT] = WIDTH * .5f - p_pix1->x;
    // pq[0][BOTTOM] = -dy;
	// pq[1][BOTTOM] = p_pix1->y + HEIGHT * .5f;
    // pq[0][TOP] = dy;
	// pq[1][TOP] = HEIGHT * .5f - p_pix1->y;
	pq[0][LEFT] = -dx;
	pq[1][LEFT] = 0;
    pq[0][RIGHT] = dx;
	pq[1][RIGHT] = WIDTH - p_pix1->x;
    pq[0][BOTTOM] = -dy;
	pq[1][BOTTOM] = 0;
    pq[0][TOP] = dy;
	pq[1][TOP] = HEIGHT - p_pix1->y;
    for (int i = 0; i < 4; i++) {
        if (pq[0][i] == 0) {
            if (pq[1][i] < 0) return 0; // ÐžÑ‚Ñ€ÐµÐ·Ð¾Ðº Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð·Ð° Ð³Ñ€Ð°Ð½Ð¸Ñ†ÐµÐ¹
        } else {
            float t = pq[1][i] / pq[0][i];
            if (pq[0][i] < 0) {
                if (t > t_out) return 0;
                else if (t > t_in) t_in = t;
            } else {
                if (t < t_in) return 0;
                else if (t < t_out) t_out = t;
            }
        }
    }
    p_pix1n->x = p_pix1->x + t_in * dx;
	p_pix1n->y = p_pix1->y + t_in * dx;
	p_pix2n->x = p_pix2->x + t_in * dx;
	p_pix2n->y = p_pix2->y + t_in * dx;
    return 1;
}
